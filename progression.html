<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#E5D4FF">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180.png">
    <link rel="apple-touch-icon" sizes="192x192" href="apple-touch-icon-192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="apple-touch-icon-512.png">
    <title>Ma Progression - SolFun</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="liquid-glass.css">
    <style>
        :root {
            --pastel-pink: #FFD4E5;
            --pastel-blue: #B4D4FF;
            --pastel-lavender: #E5D4FF;
            --pastel-peach: #FFE5CC;
            --pastel-mint: #D4FFEA;
            --soft-purple: #9B86BD;
            --deep-blue: #6B9BD1;
            --white: #FFFFFF;
            --text-dark: #4A4A68;
            --text-light: #7A7A9E;
            --success-green: #7FD89A;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            /* Style ajouté par liquid glass */
            font-family: 'Quicksand', sans-serif;
            /* Liquid glass background */
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 20px;
            padding: max(20px, env(safe-area-inset-top)) max(20px, env(safe-area-inset-right)) max(20px, env(safe-area-inset-bottom)) max(20px, env(safe-area-inset-left));
            -webkit-text-size-adjust: 100%;
        }
        
        .header {
            max-width: 1200px;
            margin: 0 auto 40px;
            text-align: center;
        }
        
        .page-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 3rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(155, 134, 189, 0.3);
            margin-bottom: 10px;
        }
        
        .back-link {
            color: white;
            text-decoration: none;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            text-decoration: underline;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border-radius: 25px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(155, 134, 189, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--pastel-blue), var(--pastel-lavender));
        }
        
        .stat-card:hover,
        .stat-card:active {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(155, 134, 189, 0.3);
        }
        
        .stat-icon {
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
        }
        
        .stat-value {
            font-family: 'Fredoka', sans-serif;
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--deep-blue), var(--soft-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: var(--text-light);
            font-size: 1.1rem;
            font-weight: 500;
        }
        
        .progress-section {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(155, 134, 189, 0.2);
            margin-bottom: 30px;
        }
        
        .section-title {
            font-family: 'Fredoka', sans-serif;
            font-size: 2rem;
            color: var(--soft-purple);
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .progress-bar-container {
            margin-bottom: 25px;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: var(--text-dark);
            font-weight: 600;
        }
        
        .progress-bar {
            height: 30px;
            background: var(--pastel-lavender);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--deep-blue), var(--soft-purple));
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: 600;
            transition: width 1s ease-out;
        }
        
        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .badge-item {
            background: linear-gradient(135deg, var(--pastel-blue) 0%, var(--pastel-lavender) 100%);
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .badge-item:hover,
        .badge-item:active {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(155, 134, 189, 0.3);
        }
        
        .badge-item.locked {
            background: #e0e0e0;
            opacity: 0.5;
        }
        
        .badge-icon {
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
        }

        .badge-item.locked .badge-icon {
            filter: grayscale(80%);
            opacity: 0.6;
        }
        
        .badge-name {
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-dark);
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }
        
        .action-button {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px) saturate(180%);
            -webkit-backdrop-filter: blur(10px) saturate(180%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            padding: 12px 25px;
            border-radius: 12px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            color: var(--soft-purple);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .action-button:hover,
        .action-button:active {
            background: var(--soft-purple);
            color: white;
            border-color: var(--soft-purple);
        }
        
        .action-button.danger {
            border-color: #FF9B9B;
            color: #FF6B6B;
        }
        
        .action-button.danger:hover,
        .action-button.danger:active {
            background: #FF6B6B;
            color: white;
        }
        
        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .stat-card {
                padding: 20px 15px;
            }

            .stat-value {
                font-size: 2.2rem;
            }

            .progress-section {
                padding: 25px 20px;
            }

            .section-title {
                font-size: 1.5rem;
            }

            .badges-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }

            .badge-item {
                padding: 18px 12px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-button {
                padding: 14px 20px;
                min-height: 48px;
            }
        }

        @media (max-width: 380px) {
            .page-title {
                font-size: 1.6rem;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .stat-card {
                padding: 15px 10px;
                border-radius: 18px;
            }

            .stat-value {
                font-size: 1.8rem;
            }

            .stat-label {
                font-size: 0.9rem;
            }

            .progress-section {
                padding: 20px 15px;
                border-radius: 20px;
            }

            .section-title {
                font-size: 1.3rem;
            }

            .badges-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .badge-item {
                padding: 15px 10px;
                border-radius: 16px;
            }

            .badge-name {
                font-size: 0.85rem;
            }

            .progress-bar {
                height: 24px;
            }
        }
    </style>
</head>
<body class="liquid-bg" class="liquid-bg">
    <div class="header">
        <h1 class="page-title"><span data-icon="barChart" data-icon-size="md"></span> Ma Progression</h1>
        <a href="#" class="back-link" onclick="navigateTo('index.html'); return false;">← Retour au menu</a>
    </div>
    
    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" data-icon="target" data-icon-size="lg"></div>
                <div class="stat-value" id="total-exercises">0</div>
                <div class="stat-label">Exercices réussis</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" data-icon="chartUp" data-icon-size="lg"></div>
                <div class="stat-value" id="success-rate">0%</div>
                <div class="stat-label">Taux de réussite</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" data-icon="fire" data-icon-size="lg"></div>
                <div class="stat-value" id="current-streak">0</div>
                <div class="stat-label">Meilleure série</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" data-icon="timer" data-icon-size="lg"></div>
                <div class="stat-value" id="total-time">0m</div>
                <div class="stat-label">Temps total</div>
            </div>
        </div>
        
        <div class="progress-section">
            <h2 class="section-title"><span data-icon="musicNote" data-icon-size="md"></span> Progression par niveau</h2>

            <div class="progress-bar-container">
                <div class="progress-label">
                    <span><span data-icon="cat" data-icon-size="sm"></span> Niveau 1 - Débutant</span>
                    <span id="level1-stars"></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="level1-progress"></div>
                </div>
            </div>

            <div class="progress-bar-container">
                <div class="progress-label">
                    <span><span data-icon="fox" data-icon-size="sm"></span> Niveau 2 - Explorateur</span>
                    <span id="level2-stars"></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="level2-progress"></div>
                </div>
            </div>

            <div class="progress-bar-container">
                <div class="progress-label">
                    <span><span data-icon="bear" data-icon-size="sm"></span> Niveau 3 - Aventurier</span>
                    <span id="level3-stars"></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="level3-progress"></div>
                </div>
            </div>

            <div class="progress-bar-container">
                <div class="progress-label">
                    <span><span data-icon="star" data-icon-size="sm"></span> Niveau 4 - Expert</span>
                    <span id="level4-stars"></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="level4-progress"></div>
                </div>
            </div>

            <div class="progress-bar-container">
                <div class="progress-label">
                    <span><span data-icon="trophy" data-icon-size="sm"></span> Niveau 5 - Maître</span>
                    <span id="level5-stars"></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="level5-progress"></div>
                </div>
            </div>

            <div class="progress-bar-container">
                <div class="progress-label">
                    <span><span data-icon="crown" data-icon-size="sm"></span> Niveau 6 - Dictée</span>
                    <span id="level6-stars"></span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: 0%" id="level6-progress"></div>
                </div>
            </div>
        </div>
        
        <div class="progress-section">
            <h2 class="section-title"><span data-icon="trophy" data-icon-size="md"></span> Mes badges</h2>
            
            <div class="badges-grid" id="badges-grid">
                <!-- Les badges seront générés dynamiquement -->
            </div>
            
            <div class="action-buttons">
                <button class="action-button" onclick="navigateTo('niveaux.html')"><span data-icon="gamepad" data-icon-size="sm"></span> Continuer à jouer</button>
                <button class="action-button danger" onclick="resetProgress()"><span data-icon="refresh" data-icon-size="sm"></span> Réinitialiser</button>
            </div>
        </div>
    </div>
    
    <script src="icons.js"></script>
    <script src="app.js"></script>
    <script>
        // Définition des badges avec iconFn au lieu d'emojis
        const allBadges = [
            { id: 'first-note', iconFn: 'medal', name: 'Première note', requirement: (stats) => stats.totalExercises >= 1 },
            { id: '10-success', iconFn: 'star', name: '10 succès', requirement: (stats) => stats.correctAnswers >= 10 },
            { id: 'expert-123', iconFn: 'target', name: 'Expert Do-Ré-Mi', requirement: (stats) => stats.correctAnswers >= 50 },
            { id: 'week-streak', iconFn: 'fire', name: '7 jours de suite', requirement: (stats) => stats.currentStreak >= 7 },
            { id: 'champion', iconFn: 'crown', name: 'Champion', requirement: (stats) => stats.correctAnswers >= 100 },
            { id: 'master', iconFn: 'musicalScore', name: 'Maître du solfège', requirement: (stats) => stats.totalExercises >= 200 && app.getSuccessRate() >= 90 }
        ];

        function loadStats() {
            const stats = app.state.stats;

            // Statistiques principales
            document.getElementById('total-exercises').textContent = stats.correctAnswers;
            document.getElementById('success-rate').textContent = app.getSuccessRate() + '%';
            document.getElementById('current-streak').textContent = stats.currentStreak;
            document.getElementById('total-time').textContent = formatTime(stats.totalTime);

            // Progression par niveau
            for (let i = 1; i <= 6; i++) {
                const levelKey = `level${i}`;
                const progress = app.state.progress[levelKey];
                const stars = progress.stars || 0;
                const maxStars = i; // Nombre d'étoiles = numéro du niveau
                const percentage = stars > 0 ? (stars / maxStars) * 100 : 0;

                document.getElementById(`level${i}-stars`).innerHTML = repeatIcon('star', stars, 'sm') + repeatIcon('starEmpty', maxStars - stars, 'sm');
                const progressBar = document.getElementById(`level${i}-progress`);
                progressBar.style.width = percentage + '%';
                progressBar.textContent = stars > 0 ? `${stars}/${maxStars}` : '';
            }

            // Badges
            renderBadges();
        }

        function renderBadges() {
            const badgesGrid = document.getElementById('badges-grid');
            badgesGrid.innerHTML = '';

            allBadges.forEach(badge => {
                const isEarned = badge.requirement(app.state.stats);

                const badgeElement = document.createElement('div');
                badgeElement.className = 'badge-item' + (isEarned ? '' : ' locked');
                badgeElement.innerHTML = `
                    <div class="badge-icon">${SolFunIcons[badge.iconFn]('lg')}</div>
                    <div class="badge-name">${badge.name}</div>
                `;

                if (isEarned && !app.state.stats.badges.includes(badge.id)) {
                    app.state.stats.badges.push(badge.id);
                    app.saveState();
                }

                badgesGrid.appendChild(badgeElement);
            });
        }

        function resetProgress() {
            if (app.resetProgress()) {
                loadStats();
                alert('Ta progression a été réinitialisée !');
            }
        }

        // Animer les barres de progression au chargement
        window.addEventListener('load', () => {
            loadStats();

            // Animation des barres
            setTimeout(() => {
                document.querySelectorAll('.progress-fill').forEach(bar => {
                    const width = bar.style.width;
                    bar.style.width = '0%';
                    setTimeout(() => {
                        bar.style.width = width;
                    }, 100);
                });
            }, 100);
        });
    </script>
</body>
</html>