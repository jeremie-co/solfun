<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FFE5CC">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Exercice de Rythme - SolFun</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Quicksand:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --pastel-pink: #FFD4E5;
            --pastel-blue: #B4D4FF;
            --pastel-lavender: #E5D4FF;
            --pastel-peach: #FFE5CC;
            --pastel-mint: #D4FFEA;
            --soft-purple: #9B86BD;
            --deep-blue: #6B9BD1;
            --white: #FFFFFF;
            --text-dark: #4A4A68;
            --text-light: #7A7A9E;
            --success-green: #7FD89A;
            --error-red: #FF9B9B;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Quicksand', sans-serif;
            background: linear-gradient(135deg, var(--pastel-peach) 0%, var(--pastel-pink) 100%);
            min-height: 100vh;
            min-height: -webkit-fill-available;
            padding: 20px;
            padding: max(20px, env(safe-area-inset-top)) max(20px, env(safe-area-inset-right)) max(20px, env(safe-area-inset-bottom)) max(20px, env(safe-area-inset-left));
            -webkit-text-size-adjust: 100%;
        }

        .top-bar {
            max-width: 900px;
            margin: 0 auto 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(155, 134, 189, 0.15);
        }

        .score-display {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 0.9rem;
            color: var(--text-light);
            margin-bottom: 5px;
        }

        .score-value {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--soft-purple);
        }

        .quit-button {
            background: var(--error-red);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 12px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .quit-button:hover,
        .quit-button:active {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 155, 155, 0.4);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .exercise-card {
            background: white;
            border-radius: 30px;
            padding: 50px;
            box-shadow: 0 15px 40px rgba(155, 134, 189, 0.2);
            margin-bottom: 30px;
        }

        .question-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .question-text {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.8rem;
            color: var(--text-dark);
            margin-bottom: 15px;
        }

        .rhythm-display {
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
            background: linear-gradient(135deg, var(--pastel-mint) 0%, var(--pastel-blue) 100%);
            border-radius: 20px;
            padding: 40px;
        }

        .rhythm-svg {
            width: 100%;
            max-width: 400px;
            height: 150px;
        }

        .measure-display {
            display: flex;
            gap: 20px;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
        }

        .note-figure {
            animation: noteAppear 0.5s ease-out;
        }

        @keyframes noteAppear {
            from {
                opacity: 0;
                transform: scale(0.5);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .answer-button {
            background: white;
            border: 3px solid var(--pastel-peach);
            padding: 25px;
            border-radius: 20px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.5rem;
            color: var(--soft-purple);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .answer-button:hover,
        .answer-button:active {
            transform: translateY(-5px) scale(1.05);
            border-color: var(--soft-purple);
            box-shadow: 0 10px 30px rgba(155, 134, 189, 0.3);
        }

        .answer-button.correct {
            background: var(--success-green);
            border-color: var(--success-green);
            color: white;
            animation: successPulse 0.6s ease;
        }

        .answer-button.incorrect {
            background: var(--error-red);
            border-color: var(--error-red);
            color: white;
            animation: shake 0.5s ease;
        }

        .answer-button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .feedback-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 40px 60px;
            border-radius: 25px;
            box-shadow: 0 20px 60px rgba(155, 134, 189, 0.4);
            z-index: 1000;
            text-align: center;
            transition: transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .feedback-message.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .feedback-icon {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }

        .feedback-text {
            font-family: 'Fredoka', sans-serif;
            font-size: 2rem;
            color: var(--text-dark);
        }

        .metronome-control {
            background: linear-gradient(135deg, var(--pastel-lavender) 0%, var(--pastel-pink) 100%);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
            align-items: center;
        }

        .metronome-header {
            font-family: 'Fredoka', sans-serif;
            font-size: 1.3rem;
            color: var(--text-dark);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metronome-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .bpm-control {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .bpm-button {
            background: white;
            border: 2px solid var(--soft-purple);
            color: var(--soft-purple);
            width: 40px;
            height: 40px;
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .bpm-button:hover,
        .bpm-button:active {
            background: var(--soft-purple);
            color: white;
            transform: scale(1.1);
        }

        .bpm-input {
            width: 80px;
            padding: 10px;
            border: 2px solid var(--soft-purple);
            border-radius: 10px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.5rem;
            text-align: center;
            color: var(--text-dark);
        }

        .metronome-toggle {
            background: var(--success-green);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 12px;
            font-family: 'Fredoka', sans-serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .metronome-toggle:hover,
        .metronome-toggle:active {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(127, 216, 154, 0.4);
        }

        .metronome-toggle.playing {
            background: var(--error-red);
        }

        .metronome-beat {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--soft-purple);
            opacity: 0.3;
            transition: all 0.1s ease;
        }

        .metronome-beat.active {
            opacity: 1;
            transform: scale(1.5);
        }

        @media (max-width: 768px) {
            .exercise-card {
                padding: 25px 18px;
                border-radius: 22px;
            }

            .top-bar {
                padding: 14px 18px;
                margin-bottom: 20px;
                border-radius: 16px;
            }

            .score-display {
                gap: 16px;
            }

            .score-value {
                font-size: 1.4rem;
            }

            .question-text {
                font-size: 1.4rem;
            }

            .answers-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .answer-button {
                padding: 20px 15px;
                font-size: 1.3rem;
            }

            .rhythm-display {
                padding: 25px;
            }

            .metronome-control {
                padding: 20px 15px;
            }

            .metronome-controls {
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="score-display">
            <div class="score-item">
                <div class="score-label">Mode</div>
                <div class="score-value" id="mode-display">Figures</div>
            </div>
            <div class="score-item">
                <div class="score-label">Score</div>
                <div class="score-value" id="score-display">0/0</div>
            </div>
            <div class="score-item">
                <div class="score-label">Série</div>
                <div class="score-value" id="streak-display"><span data-icon="fire" data-icon-size="sm"></span> 0</div>
            </div>
        </div>
        <button class="quit-button" onclick="quitExercise()">✕ Quitter</button>
    </div>

    <div class="container">
        <div class="exercise-card">
            <div class="question-header">
                <h2 class="question-text" id="question-text">Quelle est cette figure rythmique ? <span data-icon="drum" data-icon-size="sm"></span></h2>
            </div>

            <div class="rhythm-display" id="rhythm-display">
                <!-- Les figures rythmiques seront affichées ici -->
            </div>

            <!-- Métronome -->
            <div class="metronome-control">
                <div class="metronome-header">
                    <span data-icon="timer" data-icon-size="sm"></span>
                    Métronome
                </div>
                <div class="metronome-controls">
                    <div class="bpm-control">
                        <button class="bpm-button" onclick="adjustBPM(-10)">−10</button>
                        <button class="bpm-button" onclick="adjustBPM(-1)">−</button>
                        <input type="number" id="bpm-input" class="bpm-input" value="60" min="40" max="140" step="1" onchange="updateBPM()">
                        <button class="bpm-button" onclick="adjustBPM(1)">+</button>
                        <button class="bpm-button" onclick="adjustBPM(10)">+10</button>
                    </div>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <div class="metronome-beat" id="beat-indicator"></div>
                        <button class="metronome-toggle" id="metronome-toggle" onclick="toggleMetronome()">
                            <span data-icon="play" data-icon-size="sm"></span>
                            <span id="metronome-status">Démarrer</span>
                        </button>
                    </div>
                </div>
            </div>

            <div class="answers-grid" id="answers-grid">
                <!-- Les boutons seront générés dynamiquement -->
            </div>
        </div>
    </div>

    <div class="feedback-message" id="feedback">
        <div class="feedback-icon" id="feedbackIcon" data-icon="celebration" data-icon-size="xl"></div>
        <div class="feedback-text" id="feedbackText">Bravo !</div>
    </div>

    <!-- Modale de fin d'exercice -->
    <div class="feedback-message" id="end-modal" style="min-width:300px">
        <div class="feedback-icon" id="endModalIcon"></div>
        <div class="feedback-text" id="endModalTitle" style="margin-bottom:10px"></div>
        <div id="endModalStars" style="margin:15px 0;display:flex;justify-content:center;gap:8px"></div>
        <div id="endModalDetails" style="color:#7A7A9E;font-size:1.1rem;margin-bottom:20px"></div>
        <button class="answer-button" onclick="navigateTo('index.html')" style="font-size:1.2rem;padding:15px 40px;border-color:var(--pastel-blue)">Continuer</button>
    </div>

    <script src="icons.js"></script>
    <script src="app.js"></script>
    <script>
        // Configuration des exercices de rythme
        const rhythmExercises = {
            figures: {
                name: 'Figures',
                question: 'Quelle est cette figure rythmique ?',
                figures: [
                    { name: 'Ronde', beats: 4, symbol: 'whole' },
                    { name: 'Blanche', beats: 2, symbol: 'half' },
                    { name: 'Noire', beats: 1, symbol: 'quarter' }
                ]
            },
            counting: {
                name: 'Comptage',
                question: 'Combien de temps compte cette mesure ?',
                maxBeats: 4
            }
        };

        let currentMode = 'figures'; // ou 'counting'
        let currentFigure = null;
        let currentMeasure = null;
        let questionCount = 0;
        const maxQuestions = 10;

        // Dessiner une figure rythmique en SVG
        function drawRhythmFigure(symbol) {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('class', 'rhythm-svg note-figure');
            svg.setAttribute('viewBox', '0 0 100 100');

            const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');
            g.setAttribute('transform', 'translate(50, 50)');

            if (symbol === 'whole') {
                // Ronde (note blanche ovale)
                const ellipse = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
                ellipse.setAttribute('cx', '0');
                ellipse.setAttribute('cy', '0');
                ellipse.setAttribute('rx', '18');
                ellipse.setAttribute('ry', '13');
                ellipse.setAttribute('fill', 'none');
                ellipse.setAttribute('stroke', '#4A4A68');
                ellipse.setAttribute('stroke-width', '3');
                g.appendChild(ellipse);
            } else if (symbol === 'half') {
                // Blanche (note blanche avec tige)
                const ellipse = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
                ellipse.setAttribute('cx', '0');
                ellipse.setAttribute('cy', '0');
                ellipse.setAttribute('rx', '18');
                ellipse.setAttribute('ry', '13');
                ellipse.setAttribute('fill', 'none');
                ellipse.setAttribute('stroke', '#4A4A68');
                ellipse.setAttribute('stroke-width', '3');
                g.appendChild(ellipse);

                // Tige
                const stem = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                stem.setAttribute('x1', '17');
                stem.setAttribute('y1', '0');
                stem.setAttribute('x2', '17');
                stem.setAttribute('y2', '-35');
                stem.setAttribute('stroke', '#4A4A68');
                stem.setAttribute('stroke-width', '2.5');
                stem.setAttribute('stroke-linecap', 'round');
                g.appendChild(stem);
            } else if (symbol === 'quarter') {
                // Noire (note noire avec tige)
                const ellipse = document.createElementNS('http://www.w3.org/2000/svg', 'ellipse');
                ellipse.setAttribute('cx', '0');
                ellipse.setAttribute('cy', '0');
                ellipse.setAttribute('rx', '18');
                ellipse.setAttribute('ry', '13');
                ellipse.setAttribute('fill', '#4A4A68');
                g.appendChild(ellipse);

                // Tige
                const stem = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                stem.setAttribute('x1', '17');
                stem.setAttribute('y1', '0');
                stem.setAttribute('x2', '17');
                stem.setAttribute('y2', '-35');
                stem.setAttribute('stroke', '#4A4A68');
                stem.setAttribute('stroke-width', '2.5');
                stem.setAttribute('stroke-linecap', 'round');
                g.appendChild(stem);
            }

            svg.appendChild(g);
            return svg;
        }

        // Initialiser l'exercice
        function initExercise() {
            // Démarrer avec le mode figures
            currentMode = 'figures';
            document.getElementById('mode-display').textContent = rhythmExercises[currentMode].name;
            generateQuestion();
            updateScoreDisplay();
        }

        function generateQuestion() {
            if (questionCount >= maxQuestions) {
                endExercise();
                return;
            }

            const config = rhythmExercises[currentMode];
            document.getElementById('question-text').innerHTML = config.question + ' <span data-icon="drum" data-icon-size="sm"></span>';
            SolFunIcons.replaceIconPlaceholders();

            const rhythmDisplay = document.getElementById('rhythm-display');
            rhythmDisplay.innerHTML = '';
            const answersGrid = document.getElementById('answers-grid');
            answersGrid.innerHTML = '';

            if (currentMode === 'figures') {
                // Mode reconnaissance de figures
                currentFigure = config.figures[Math.floor(Math.random() * config.figures.length)];

                // Afficher la figure
                const figure = drawRhythmFigure(currentFigure.symbol);
                rhythmDisplay.appendChild(figure);

                // Créer les boutons de réponse
                config.figures.forEach(fig => {
                    const button = document.createElement('button');
                    button.className = 'answer-button';
                    button.textContent = fig.name;
                    button.onclick = () => checkAnswer(fig.name, button);
                    answersGrid.appendChild(button);
                });
            } else if (currentMode === 'counting') {
                // Mode comptage des temps
                const numNotes = Math.floor(Math.random() * 3) + 2; // 2 à 4 notes
                const notes = [];
                let totalBeats = 0;

                // Générer une mesure aléatoire
                const allFigures = rhythmExercises.figures.figures;
                for (let i = 0; i < numNotes && totalBeats < 4; i++) {
                    const availableFigures = allFigures.filter(f => totalBeats + f.beats <= 4);
                    if (availableFigures.length === 0) break;

                    const fig = availableFigures[Math.floor(Math.random() * availableFigures.length)];
                    notes.push(fig);
                    totalBeats += fig.beats;
                }

                currentMeasure = { notes, totalBeats };

                // Afficher les notes
                const measureDiv = document.createElement('div');
                measureDiv.className = 'measure-display';
                notes.forEach(note => {
                    const fig = drawRhythmFigure(note.symbol);
                    measureDiv.appendChild(fig);
                });
                rhythmDisplay.appendChild(measureDiv);

                // Créer les boutons de réponse (1 à 4 temps)
                for (let i = 1; i <= 4; i++) {
                    const button = document.createElement('button');
                    button.className = 'answer-button';
                    button.textContent = i + ' temps';
                    button.onclick = () => checkAnswer(i, button);
                    answersGrid.appendChild(button);
                }
            }

            questionCount++;
        }

        function checkAnswer(selectedAnswer, button) {
            let isCorrect = false;

            if (currentMode === 'figures') {
                isCorrect = selectedAnswer === currentFigure.name;
            } else if (currentMode === 'counting') {
                isCorrect = selectedAnswer === currentMeasure.totalBeats;
            }

            // Désactiver tous les boutons
            document.querySelectorAll('.answer-button').forEach(btn => {
                btn.disabled = true;
            });

            const feedback = document.getElementById('feedback');
            const feedbackIcon = document.getElementById('feedbackIcon');
            const feedbackText = document.getElementById('feedbackText');

            if (isCorrect) {
                button.classList.add('correct');
                feedbackIcon.innerHTML = SolFunIcons.celebration('xl');
                feedbackText.textContent = 'Bravo ! C\'est la bonne réponse !';
                sound.playSuccess();
                app.updateStats(true);
            } else {
                button.classList.add('incorrect');
                feedbackIcon.innerHTML = SolFunIcons.oops('xl');

                if (currentMode === 'figures') {
                    feedbackText.textContent = 'Presque ! C\'était ' + currentFigure.name + ' !';
                } else {
                    feedbackText.textContent = 'Presque ! C\'était ' + currentMeasure.totalBeats + ' temps !';
                }

                sound.playError();
                app.updateStats(false);

                // Montrer la bonne réponse
                setTimeout(() => {
                    document.querySelectorAll('.answer-button').forEach(btn => {
                        if (currentMode === 'figures' && btn.textContent === currentFigure.name) {
                            btn.classList.add('correct');
                        } else if (currentMode === 'counting' && btn.textContent === currentMeasure.totalBeats + ' temps') {
                            btn.classList.add('correct');
                        }
                    });
                }, 1000);
            }

            updateScoreDisplay();

            // Afficher le feedback
            setTimeout(() => {
                feedback.classList.add('show');
            }, 500);

            // Cacher le feedback et passer à la question suivante
            setTimeout(() => {
                feedback.classList.remove('show');
                setTimeout(() => {
                    // Alterner entre les modes
                    if (questionCount === 5) {
                        currentMode = 'counting';
                        document.getElementById('mode-display').textContent = rhythmExercises[currentMode].name;
                    }
                    generateQuestion();
                }, 400);
            }, 2500);
        }

        function updateScoreDisplay() {
            const session = app.state.currentSession;
            document.getElementById('score-display').textContent = `${session.score}/${session.total}`;
            document.getElementById('streak-display').innerHTML = `${SolFunIcons.fire('sm')} ${session.streak}`;
        }

        function endExercise() {
            const session = app.state.currentSession;
            const successRate = session.total > 0 ? Math.round((session.score / session.total) * 100) : 0;

            // Calculer les étoiles
            let stars = 0;
            if (successRate >= 90) stars = 3;
            else if (successRate >= 70) stars = 2;
            else if (successRate >= 50) stars = 1;

            // Afficher la modale de fin
            const modal = document.getElementById('end-modal');
            document.getElementById('endModalIcon').innerHTML = SolFunIcons.trophy('xl');
            document.getElementById('endModalTitle').textContent = 'Exercice terminé !';
            document.getElementById('endModalStars').innerHTML = repeatIcon('star', stars, 'lg') + repeatIcon('starEmpty', 3 - stars, 'lg');
            document.getElementById('endModalDetails').textContent = `Score : ${session.score}/${session.total} (${successRate}%)`;
            modal.classList.add('show');
        }

        function quitExercise() {
            if (confirm('Es-tu sûr de vouloir quitter cet exercice ?')) {
                stopMetronome();
                navigateTo('index.html');
            }
        }

        // Métronome
        let metronomeInterval = null;
        let metronomeBPM = 60;
        let metronomeAudioContext = null;

        function initMetronome() {
            // Créer un contexte audio pour le métronome
            if (!metronomeAudioContext) {
                metronomeAudioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function adjustBPM(delta) {
            const input = document.getElementById('bpm-input');
            let newBPM = parseInt(input.value) + delta;
            newBPM = Math.max(40, Math.min(140, newBPM));
            input.value = newBPM;
            updateBPM();
        }

        function updateBPM() {
            const input = document.getElementById('bpm-input');
            let bpm = parseInt(input.value);

            // Valider la plage
            if (isNaN(bpm) || bpm < 40) bpm = 40;
            if (bpm > 140) bpm = 140;

            input.value = bpm;
            metronomeBPM = bpm;

            // Si le métronome est en cours, le redémarrer avec le nouveau tempo
            if (metronomeInterval) {
                stopMetronome();
                startMetronome();
            }
        }

        function toggleMetronome() {
            if (metronomeInterval) {
                stopMetronome();
            } else {
                startMetronome();
            }
        }

        function startMetronome() {
            initMetronome();

            const toggle = document.getElementById('metronome-toggle');
            const status = document.getElementById('metronome-status');
            toggle.classList.add('playing');
            status.textContent = 'Arrêter';

            const interval = (60 / metronomeBPM) * 1000;

            // Jouer le premier tick immédiatement
            playMetronomeTick();

            metronomeInterval = setInterval(() => {
                playMetronomeTick();
            }, interval);
        }

        function stopMetronome() {
            if (metronomeInterval) {
                clearInterval(metronomeInterval);
                metronomeInterval = null;

                const toggle = document.getElementById('metronome-toggle');
                const status = document.getElementById('metronome-status');
                const beat = document.getElementById('beat-indicator');

                toggle.classList.remove('playing');
                status.textContent = 'Démarrer';
                beat.classList.remove('active');
            }
        }

        function playMetronomeTick() {
            // Effet visuel
            const beat = document.getElementById('beat-indicator');
            beat.classList.add('active');
            setTimeout(() => {
                beat.classList.remove('active');
            }, 100);

            // Son du métronome
            if (metronomeAudioContext) {
                const oscillator = metronomeAudioContext.createOscillator();
                const gainNode = metronomeAudioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(metronomeAudioContext.destination);

                oscillator.frequency.value = 800;
                oscillator.type = 'sine';

                gainNode.gain.setValueAtTime(0.3, metronomeAudioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, metronomeAudioContext.currentTime + 0.1);

                oscillator.start(metronomeAudioContext.currentTime);
                oscillator.stop(metronomeAudioContext.currentTime + 0.1);
            }
        }

        // Démarrer une session de rythme
        app.state.currentSession = {
            level: 0,
            score: 0,
            total: 0,
            streak: 0
        };
        app.saveState();

        // Démarrer l'exercice
        initExercise();
    </script>
</body>
</html>
